CREATE TABLE users (
user TEXT PRIMARY KEY,
email TEXT,
pass TEXT
);

CREATE TABLE secrets(secret text);
INSERT INTO secrets VALUES ('s3cretk3y');

CREATE TRIGGER encrypt_pass AFTER INSERT ON users 
    BEGIN
        UPDATE users SET pass = encrypt(new.pass, (SELECT secret FROM secrets LIMIT 1))
            WHERE user = new.user;
    END;


INSERT INTO users VALUES ('peter', 'peter@huawei.com', 'role_ruler');
INSERT INTO users VALUES ('josh', 'josh@huawei.com', 'turkey');

SELECT user, pass, decrypt(pass, (SELECT secret FROM secrets LIMIT 1)) AS decrypted FROM users;
