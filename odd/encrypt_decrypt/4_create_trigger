gsql -d opengauss -e -c "CREATE OR REPLACE FUNCTION encrypt_password() 
RETURNS TRIGGER AS
$$
    DECLARE
    BEGIN
        UPDATE users SET passwd = gs_encrypt(NEW.passwd, 
	    (SELECT secret FROM secrets LIMIT 1)) 
	WHERE username = NEW.username;
        RETURN NEW;
    END
$$LANGUAGE PLPGSQL;"

gsql -d opengauss -e -c "CREATE TRIGGER encrypt_passwd_trigger AFTER 
    INSERT ON users 
FOR EACH ROW EXECUTE PROCEDURE encrypt_password();"

